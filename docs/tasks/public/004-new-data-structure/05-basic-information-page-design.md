# BOMアイテム詳細ページ設計

## 1. ページ構成

既存のBomDetailHeaderのタブ構成を拡張：

| タブ | パス | 担当する機能 |
|------|------|-------------|
| 基本情報 | /basic-information | メタデータ編集、図面/ドキュメント管理、BOM構成確認 |
| コメント | /comments | コメント一覧・投稿（既存） |
| タスク | /tasks | タスク一覧・管理（既存） |
| リビジョン | /revisions | リビジョン履歴、新リビジョン作成（**新規追加**） |

---

## 2. Basic Informationページのユースケース

### 閲覧系
| # | ユースケース | 優先度 |
|---|-------------|--------|
| V1 | メタデータ（品番、品名、仕様など）を確認する | 高 |
| V2 | 図面を確認・ダウンロードする | 高 |
| V3 | ドキュメントを確認・ダウンロードする | 高 |
| V4 | BOM構成（子部品）を確認する | 高 |
| V5 | 使用先（親アセンブリ）を確認する | 高 |

### 編集系
| # | ユースケース | 優先度 |
|---|-------------|--------|
| E1 | メタデータを更新・保存する | 高 |
| E2 | 図面をアップロード・削除する | 高 |
| E3 | ドキュメントをアップロード・削除する | 高 |

### ナビゲーション系
| # | ユースケース | 優先度 |
|---|-------------|--------|
| N1 | 子部品の詳細ページに遷移する | 高 |
| N2 | 親アセンブリの詳細ページに遷移する | 高 |
| N3 | Canvas表示に切り替える | 中 |

---

## 3. レイアウト設計

### 方針
- BomDetailHeaderは既存のまま活用
- 3カラム構成でコンテンツを配置
- ヘッダーに要素を増やさない（シンプルに保つ）

### ASCII

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│ AppHeader (既存)                                                                                │
├─────────────────────────────────────────────────────────────────────────────────────────────────┤
│ BomDetailHeader (既存)                                                                          │
│ [基本情報] [コメント] [タスク] [リビジョン]                                    [...メニュー]    │
├──────────────────────┬──────────────────────────────────────────────┬───────────────────────────┤
│                      │                                              │                           │
│  左カラム (w-72)     │  中央カラム (flex-1)                         │  右カラム (w-96)          │
│  BOM構成/使用先      │  図面・ドキュメント ギャラリー               │  メタデータ編集           │
│                      │                                              │                           │
│ ┌──────────────────┐ │ ┌──────────────────────────────────────────┐ │ ┌───────────────────────┐ │
│ │ [子部品] [使用先]│ │ │ [図面] [ドキュメント]                    │ │ │ ARM-1000             │ │
│ ├──────────────────┤ │ ├──────────────────────────────────────────┤ │ │ 産業用ロボットアーム │ │
│ │                  │ │ │                                          │ │ │ Rev.A ● Released     │ │
│ │ ▼ ARM-1000       │ │ │  ┌────────────┐ ┌────────────┐           │ │ ├───────────────────────┤ │
│ │   ├─ Assy-001    │ │ │  │            │ │            │           │ │ │                       │ │
│ │   │  ├─ Part-001 │ │ │  │  [図面1]   │ │  [図面2]   │           │ │ │ 基本情報              │ │
│ │   │  └─ Part-002 │ │ │  │            │ │            │           │ │ │ ┌─────────┬─────────┐ │ │
│ │   └─ Assy-002    │ │ │  │ サムネイル │ │ サムネイル │           │ │ │ │品番     │品名     │ │ │
│ │                  │ │ │  │            │ │            │           │ │ │ │[ARM-100]│[産業用.]│ │ │
│ │ (クリックで遷移) │ │ │  └────────────┘ └────────────┘           │ │ │ ├─────────┼─────────┤ │ │
│ │                  │ │ │  drawing-001   drawing-002               │ │ │ │タイプ   │LC状態   │ │ │
│ │                  │ │ │                                          │ │ │ │[Product]│[承認済] │ │ │
│ │                  │ │ │  ┌────────────┐                          │ │ │ └─────────┴─────────┘ │ │
│ │                  │ │ │  │            │                          │ │ │                       │ │
│ │                  │ │ │  │    [+]     │  ドラッグ&ドロップ       │ │ │ カスタム属性          │ │
│ │                  │ │ │  │   追加     │  でアップロード          │ │ │ ┌─────────┬─────────┐ │ │
│ │                  │ │ │  │            │                          │ │ │ │材質     │重量     │ │ │
│ │                  │ │ │  └────────────┘                          │ │ │ │[SUS304 ]│[12.5kg ]│ │ │
│ │                  │ │ │                                          │ │ │ ├─────────┼─────────┤ │ │
│ │                  │ │ │                                          │ │ │ │耐荷重   │精度     │ │ │
│ │                  │ │ │                                          │ │ │ │[50kg   ]│[±0.1mm]│ │ │
│ │                  │ │ │                                          │ │ │ └─────────┴─────────┘ │ │
│ │                  │ │ │                                          │ │ ├───────────────────────┤ │
│ │                  │ │ │                                          │ │ │ [保存]                │ │
│ └──────────────────┘ │ └──────────────────────────────────────────┘ │ └───────────────────────┘ │
│                      │                                              │                           │
└──────────────────────┴──────────────────────────────────────────────┴───────────────────────────┘
```

---

## 4. 各カラムの詳細

### 4.1 左カラム: BOM構成 / 使用先 (w-72)

**タブ切り替え:**
| タブ | 内容 |
|------|------|
| 子部品 | このアイテムを構成する部品ツリー |
| 使用先 | このアイテムが使われている親一覧（Where-Used） |

**インタラクション:**
- ノードクリック → そのアイテムの詳細ページへ遷移
- 現在のアイテムはハイライト表示

### 4.2 中央カラム: 図面・ドキュメント ギャラリー (flex-1)

**タブ切り替え:**
| タブ | 内容 |
|------|------|
| 図面 | 2D/3D図面のサムネイルギャラリー |
| ドキュメント | 仕様書、検査基準書などのファイル一覧 |

**図面ギャラリー:**
- グリッド表示（サムネイル大きめ）
- クリックでプレビュー/ダウンロード
- [+] ボタンまたはドラッグ&ドロップでアップロード
- 削除ボタン（ホバー時表示）

**ドキュメント一覧:**
- リスト表示（アイコン + ファイル名 + 更新日）
- クリックでプレビュー/ダウンロード
- [+] ボタンまたはドラッグ&ドロップでアップロード

### 4.3 右カラム: メタデータ編集 (w-96)

**ヘッダー部分:**
- 品番（大きく）
- 品名
- リビジョン + ステータスバッジ

**フォーム部分:**
- 基本情報: 品番、品名、タイプ、LC状態など
- カスタム属性: Facetから動的に生成
- **2カラムグリッド**でコンパクトに

**フッター:**
- 保存ボタン（変更時のみ活性化）

---

## 5. 状態管理

| 状態 | 型 | 説明 |
|------|-----|------|
| activeTab | 'children' \| 'whereUsed' | 左カラムのタブ |
| formData | Record<string, unknown> | 編集中のフォームデータ |
| isDirty | boolean | 未保存の変更があるか |

---

## 6. BomDetailHeader への追加

```tsx
const tabs = [
  { label: '基本情報', path: 'basic-information', icon: Info },
  { label: 'コメント', path: 'comments', icon: MessageSquare },
  { label: 'タスク', path: 'tasks', icon: CheckSquare },
  { label: 'リビジョン', path: 'revisions', icon: GitBranch }, // 追加
];
```

---

## 7. 実装ステップ

1. [ ] BomDetailHeaderにリビジョンタブを追加
2. [ ] 左カラム: BOM構成/使用先の実装
3. [ ] 中央カラム: メタデータ編集フォーム（3カラム）
4. [ ] 右カラム: 図面/ドキュメント管理
5. [ ] /revisions ページの作成

---

**作成日**: 2025-01-09
